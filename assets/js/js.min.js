// @ts-nocheck
let takeData=async()=>{try{const e=await fetch("bd.json");if(!e.ok)throw new Error("Network response was not ok "+e.statusText);viewAllData(await e.json())}catch(e){console.error(e)}};const searchItems=document.querySelector(".search-items");function viewAllData(e){e.sort().forEach((e=>{let t=`<li class="search-item" data-id="${e.id}" data-name="${e.name}">\n                        <div class="search-item-title-wrapper">\n                            <p>${e.name}</p>\n                            <button class="btn-add">Добавить</button>\n                        </div> \n                    </li>`;searchItems.insertAdjacentHTML("beforeend",t)}))}takeData();const searchInput=document.querySelector(".search-input");searchInput.addEventListener("input",(()=>{document.querySelectorAll(".search-item").forEach((e=>{e.children[0].textContent.includes(searchInput.value.trim())?e.classList.remove("hidden"):e.classList.add("hidden")}))}));let arrSaveData=[];function addZone(e){e.setAttribute("data-status","active");e.insertAdjacentHTML("beforeend",'\n        <div class="price-data">\n            <div>\n                <p>Базовая стоимость доставки:</p>\n                <div>\n                <input type="number" class="price-input" pattern="^d+(.d{1,2})?$">\n                </div>\n                <p>₽</p>\n            </div>\n            <button class="add-markup">Добавить наценку</button>\n        </div>\n    ')}function removeZone(e){e.children[1].remove(0),e.removeAttribute("data-status")}function addMarkup(e){e.setAttribute("data-status","active");let t=`\n        <div class="markup-data" data-id=${Date.now()}>\n            <div class="markup-data-inputs">\n                <div>\n                    <input type="number" class="markup-input-min inp" pattern="^d+(.d{1,3})?$">\n                    <label>кг</label>\n                </div>\n                <span>-</span>\n                <div>\n                    <input type="number" class="markup-input-max inp" pattern="^d+(.d{1,3})?$">\n                      <label>кг</label>\n                </div>\n            </div> \n            <div class="markup-data-result-wrapper">\n                <div class="markup-data-result">\n                    <div>\n                        <input type="number" class="markup-price inp" pattern="^d+(.d{1,2})?$">\n                        <p>₽</p>\n                    </div>\n                    <p>Итоговая стоимость: <span class="cur-price"></span> ₽</p>\n                </div>\n                <button class="delete-markup">Удалить наценку</button>\n            </div>\n        </div>\n    `;e.insertAdjacentHTML("beforeend",t)}document.addEventListener("click",(e=>{let t=e.target;if(t.classList.contains("btn-add")){let e=t.closest(".search-item").getAttribute("data-id");if("Добавить"===t.textContent){t.textContent="Удалить",addZone(t.closest(".search-item"));let a={rate_area_id:e,base_charge_value:"",extra_charges:[]};arrSaveData.push(a)}else{t.textContent="Добавить",removeZone(t.closest(".search-item"));const a=arrSaveData.findIndex((t=>t.rate_area_id===e));-1!==a&&arrSaveData.splice(a,1)}}})),document.addEventListener("input",(e=>{let t=e.target.closest(".price-data");if(e.target.classList.contains("price-input")){e.target.value.replace(/[^0-9.]/g,"");const a=e.target.value.split(".");a.length>2&&(e.target.value=a[0]+"."+a.slice(1).join("")),a[1]&&a[1].length>2&&(e.target.value=a[0]+"."+a[1].slice(0,2));let r=e.target.closest(".search-item").getAttribute("data-id"),n=t.parentElement.querySelectorAll(".markup-data");arrSaveData.find((e=>e.rate_area_id===r)).base_charge_value=e.target.value,n.forEach((t=>{t.querySelector(".cur-price").textContent=e.target.value}))}})),document.addEventListener("click",(e=>{let t=e.target;t.classList.contains("add-markup")&&addMarkup(t.closest(".search-item"))}));let markupSave={min_weight:"",max_weight:"",charge_value:""};document.addEventListener("input",(e=>{if(e.target.classList.contains("markup-input-min")){e.target.value.replace(/[^0-9.]/g,"");const t=e.target.value.split(".");t.length>3&&(e.target.value=t[0]+"."+t.slice(1).join("")),t[1]&&t[1].length>3&&(e.target.value=t[0]+"."+t[1].slice(0,3)),markupSave.min_weight=e.target.value}if(e.target.classList.contains("markup-input-max")){e.target.value.replace(/[^0-9.]/g,"");const t=e.target.value.split(".");t.length>3&&(e.target.value=t[0]+"."+t.slice(1).join("")),t[1]&&t[1].length>3&&(e.target.value=t[0]+"."+t[1].slice(0,3)),markupSave.max_weight=e.target.value}})),document.addEventListener("input",(e=>{if(e.target.classList.contains("markup-price")){let t=e.target.closest(".search-item"),a=t.querySelectorAll(".markup-data"),r=t.querySelector(".price-input").value;a.forEach((e=>{let t=e.querySelector(".cur-price"),a=e.querySelector(".markup-price");t.textContent=Number(r)+Number(a.value)}))}})),document.addEventListener("click",(e=>{let t=e.target;t.classList.contains("delete-markup")&&t.closest(".markup-data").remove()}));const saveBtn=document.querySelector(".save-btn");let group=[];saveBtn.addEventListener("click",(()=>{document.querySelectorAll(".markup-price").forEach((e=>{""===e.value?e.parentElement.classList.add("errore-markup"):e.parentElement.classList.remove("errore-markup")}));document.querySelectorAll(".price-input").forEach((e=>{""===e.value?e.parentElement.classList.add("errore-price"):e.parentElement.classList.remove("errore-price")}));const e=document.querySelectorAll(".markup-input-min");document.querySelectorAll(".markup-input-max").forEach((e=>{""===e.value?e.parentElement.classList.add("errore-weight"):e.parentElement.classList.remove("errore-weight")})),e.forEach((e=>{""===e.value?e.parentElement.classList.add("errore-weight"):e.parentElement.classList.remove("errore-weight")})),calcData(),validateInputs(),checkWieghtRadio(),hasNonEmptyValues(fullData)&&(alert("СОХРАНЕНО"),console.log(fullData))}));let fullData=[],saveData={rate_area_id:"",base_charge_value:"",extra_charges:[]};function calcData(){const e=document.querySelectorAll(".search-item");fullData.length=0,e.forEach((e=>{if(e.getAttribute("data-status")){let t={rate_area_id:"",base_charge_value:"",extra_charges:[]},a=e.getAttribute("data-id"),r=e.querySelector(".price-input").value,n=e.querySelectorAll(".markup-data");t.rate_area_id=a,t.base_charge_value=r,n.forEach((e=>{let a={min_weight:"",max_weight:"",charge_value:""},r=e.querySelector(".markup-input-min").value,n=e.querySelector(".markup-input-max").value,l=e.querySelector(".markup-price").value;a.min_weight=r,a.max_weight=n,a.charge_value=l,t.extra_charges.push(a)})),fullData.push(t)}})),0===fullData.length&&alert("Доставка не настроена")}function validateInputs(){group.length=0;document.querySelectorAll(".search-item").forEach((e=>{if(e.getAttribute("data-status")){e.querySelectorAll(".markup-data").forEach(((e,t)=>{let a=e.getAttribute("data-id"),r={id:"",min:"",max:""},n=e.querySelector(".markup-input-min").value,l=e.querySelector(".markup-input-max").value;r.min=n,r.max=l,r.id=a,group.push(r)}))}}))}function filterOverlappingRanges(e){return e.filter((t=>{const a=parseInt(t.min),r=parseInt(t.max);return e.some((e=>{if(t.id===e.id)return!1;const n=parseInt(e.min),l=parseInt(e.max);return a<=l&&r>=n||a===n||r===l}))}))}function checkWieghtRadio(){const e=filterOverlappingRanges(group),t=document.querySelectorAll(".markup-data");t.forEach((e=>{e.querySelector(".markup-input-min").parentElement.classList.remove("error-input-text"),e.querySelector(".markup-input-max").parentElement.classList.remove("error-input-text")})),e.forEach((e=>{t.forEach((t=>{t.getAttribute("data-id")===e.id&&(t.querySelector(".markup-input-min").parentElement.classList.add("error-input-text"),t.querySelector(".markup-input-max").parentElement.classList.add("error-input-text"))}))}))}function hasNonEmptyValues(e){if(0===e.length)return!1;let t=e.every((e=>Object.values(e).every((e=>null!=e&&""!==e))));return!1!==function(){let e=document.querySelectorAll(".inp"),t=[];return e.forEach((e=>{t.push(e.value)})),t.every((e=>""!==e))}()&&!1!==t}